---
id: javascript-this
title: JavaScript - this
sidebar_label: ä»€éº¼æ˜¯ this ?
sidebar_position: 2
tags: [JavaScript, this, ä¸‹ç­å¾Œçš„ç¨‹å¼è®€æ›¸æœƒ, å‰ç«¯é¢è©¦é¡Œ]
---

# JavaScript - this

> æ­¤ç­†è¨˜éåŸå‰µï¼Œå¤§éƒ¨åˆ†å…§å®¹åƒè€ƒ Huli æ–‡ç«  [æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚](https://blog.huli.tw/2019/02/23/javascript-what-is-this/) æ’°å¯«ã€‚

## `Call()` & `Apply()` é‹ç”¨

### Function èª¿ç”¨æ–¹å¼

1. `fn(arguments)` ( ä¸€èˆ¬èª¿ç”¨ï¼Œå±¬æ–¼èªæ³•ç³– )
2. `fn.call(thisæŒ‡å‘, arguments)` ( éš±å¼èª¿ç”¨ )
3. `fn.apply(thisæŒ‡å‘, [arguments])` ( éš±å¼èª¿ç”¨ )

```jsx showLineNumbers
function test() {
  console.log('test')
}

test() === test.call() // true
test() === test.apply() // true
```

<br />

### `call` å’Œ `apply` çš„å€åˆ¥åƒ…åƒ…æ˜¯ç¬¬äºŒå€‹åƒæ•¸çš„å·®ç•°

1. `call` å¯ä»¥å¾ç¬¬ 2 å€‹åƒæ•¸å‚³åˆ° n å€‹åƒæ•¸ `fn.call(undefined, 1, 2, 3, 4...)`ã€‚
2. `apply` åœ¨ç¬¬ 2 å€‹åƒæ•¸å‚³å…¥é™£åˆ—ï¼Œå¾Œé¢å†å‚³å…¥å‰‡ç„¡æ•ˆ `fn.apply(undefined, [1, 2, 3, 4...])`ã€‚

<br />

`call()` å¯ä»¥å‚³å…¥å¤šå€‹åƒæ•¸ :

```jsx showLineNumbers
function test(a, b, c) {
  console.log(arguments)
}

test.call(undefined, 1, 2, 3)
// Arguments(3) [1, 2, 3]
```

`apply()` å‰‡æ˜¯å‚³å…¥ä¸€å€‹é™£åˆ—åƒæ•¸ :

```jsx showLineNumbers
function test(a, b, c) {
  console.log(arguments)
}

// highlight-next-line
test.apply(undefined, [1, 2, 3])
// Arguments(3) [1, 2, 3]
```

`call()` å‚³å…¥é™£åˆ— :

```jsx showLineNumbers
function test(a, b, c) {
  console.log(arguments)
}

test.call(undefined, [1, 2, 3])
// Arguments [[1, 2, 3]]
```

`apply()` å‚³å…¥å¤šå€‹é™£åˆ—åƒæ•¸æ²’ç”¨ :

```jsx showLineNumbers
function test(a, b, c) {
  console.log(arguments)
}

test.apply(undefined, [1, 2, 3], [4, 5, 6], [7, 8, 9])
// Arguments(3) [1, 2, 3]
```

### `call` å’Œ `apply` æ˜¯ç‚ºäº†æ”¹è®Š `this` æŒ‡å‘è€Œå­˜åœ¨çš„

```jsx
const obj1 = {
  num: 20,
  fn(n) {
    console.log(this.num + n)
  },
}

const obj2 = {
  num: 15,
  fn(n) {
    console.log(this.num - n)
  },
}

// highlight-start
obj1.fn(10) // ?
obj1.fn.call(obj2, 10) // ?
// highlight-end
```

<details>
  <summary>
    <code>obj1.fn(10)</code> çš„åŸ·è¡Œçµæœ ?
  </summary>
  <p>
    <code>30</code>ï¼Œç”± obj1 å‘¼å« <code>fn(10)</code>ï¼Œå› æ­¤ <code>this</code>{' '}
    æŒ‡å‘ <code>obj1</code>ã€‚
  </p>
</details>

<details>
  <summary>
    <code>obj1.fn.call(obj2, 10)</code> çš„åŸ·è¡Œçµæœ ?
  </summary>
  <p>
    <code>25</code>ï¼Œå› ç‚º <code>this</code> å·²ç¶“æŒ‡å‘ <code>obj2</code>ï¼Œæ‰€ä»¥{' '}
    <code>obj1</code> çš„ <code>fn(n)</code> è£¡é¢æ‰€å–å¾—çš„ <code>this.num</code>{' '}
    æœƒæ˜¯ <code>obj2</code> çš„ <code>num: 15</code>ã€‚
  </p>
</details>

<br />

## å¦‚ä½•å¾—çŸ¥ this æŒ‡å‘èª° ?

ğŸ’¡ ä¸€æ—¦è„«é›¢äº†ç‰©ä»¶ï¼Œä¸å¤ªéœ€è¦é—œæ³¨ `this` çš„å€¼ï¼Œå› ç‚ºæ²’ä»€éº¼æ„ç¾©ã€‚

```jsx showLineNumbers
// ç„¡æ„ç¾©çš„ this
function hello() {
  console.log(this)
}

// highlight-next-line
hello() // ?
```

1. åš´æ ¼æ¨¡å¼å›å‚³ `undefined`
2. éåš´æ ¼æ¨¡å¼å›å‚³ `window`
3. éåš´æ ¼æ¨¡å¼ï¼Œnode.js å›å‚³ `global`

:::info
`this` çš„å€¼èˆ‡ä½œç”¨åŸŸã€ç¨‹å¼ç¢¼çš„ä½ç½®åœ¨å“ªè£¡å®Œå…¨ç„¡é—œï¼Œåªè·Ÿ**ã€Œä½ å¦‚ä½•å‘¼å«ã€**æœ‰é—œã€‚
:::

ç¯„ä¾‹ :

```jsx showLineNumbers
const obj = {
  num: 1,
  hello() {
    console.log(this)
  },
}

obj.hello() // {num: 1, hello: Æ’}
const hey = obj.hello
hey() // window
```

èª°å‘¼å«å‡½å¼ï¼Œå°±æŠŠèª°æ”¾é€² call ç¬¬ä¸€å€‹åƒæ•¸ :

```jsx showLineNumbers
obj.hello.call(obj) // this æŒ‡å‘ objï¼Œå°å‡º {num: 1, hello: Æ’}
hey.call() // this æŒ‡å‘ windowï¼Œå°å‡º Window{...}
```

<br />

è®Šç•°é¡Œ :

```jsx showLineNumbers
const num = 10
const obj = {
  num: 20,
  fn() {
    function test() {
      console.log(this.num)
    }
    test()
  },
}

// highlight-next-line
obj.fn() // ?
```

<details>
  <summary>
    <code>obj.fn()</code> çš„åŸ·è¡Œçµæœç‚ºä½• ?
  </summary>
  <p>
    ç­”æ¡ˆæ˜¯ <code>undefined</code>
  </p>
  <p>
    çœŸæ­£å‘¼å« <code>this</code> çš„æ˜¯ <code>test</code> é€™å€‹å‡½å¼ï¼Œæ”¹æˆä½¿ç”¨ call
    å‘¼å« : <code>test.call()</code>
    ï¼Œåœ¨æ²’æœ‰æŒ‡å®š call ç¬¬ä¸€å€‹åƒæ•¸æ™‚ï¼Œéƒ½æ˜¯é è¨­ç¶å®šå…¨åŸŸï¼Œä¹Ÿå°±æ˜¯ <code>window</code>
    ã€‚
  </p>
  <p>
    è‹¥ä»Šå¤©å¤–å±¤çš„ <code>num</code> æ˜¯ä½¿ç”¨
    <code>var</code> å®£å‘Šï¼Œå‰‡ç­”æ¡ˆæœƒæ˜¯ <code>10</code>ï¼Œä½† <code>let</code> å’Œ <code>
      const
    </code>
    éƒ½æœ‰è‡ªå·±çš„å€å¡Šä½œç”¨åŸŸï¼Œå› æ­¤åœ¨ <code>this</code> æŒ‡å‘å…¨åŸŸä¸‹è®€å–ä¸åˆ°{' '}
    <code>num</code>ï¼Œæ‰€ä»¥ç‚º
    <code>undefined</code>ã€‚
  </p>
</details>

<br />

## this é¢è©¦é¡Œ

### 1. this æ˜¯ä»€éº¼ ? ä»€éº¼æ˜¯ this ? this æ˜¯ä»€éº¼æ˜¯ this ? ä»€éº¼æ˜¯ this æ˜¯ä»€éº¼ ? ( å¤ äº†...

æ¯ä¸€å€‹ function åœ¨è¢«åŸ·è¡Œçš„æ™‚å€™éƒ½æœƒæœ‰ä¸€å€‹ reference ( åƒç…§ ) æŒ‡å‘ **æ‰€å±¬çš„ç’°å¢ƒ** ï¼Œé€™å°±æ˜¯ **this**ã€‚

<br />

### 2. Function æœ‰å“ªäº›èª¿ç”¨çš„æ–¹å¼ ? Function è£¡é¢çš„ this åˆæ˜¯æŒ‡å‘èª° ?

**ä¸€èˆ¬èª¿ç”¨**<br />
`fn()`ï¼Œfunction ( `fn()` ) çš„ `this` æŒ‡å‘å…¨åŸŸç‰©ä»¶ï¼Œéåš´æ ¼æ¨¡å¼ä¸‹ç‚º `window`ï¼Œåš´æ ¼æ¨¡å¼ä¸‹ç‚º `undefined`ã€‚

**ç‰©ä»¶ä¸­èª¿ç”¨**<br />
`obj.fn()`ï¼Œfunction ( `obj.fn()` ) è£¡é¢çš„ this æŒ‡å‘å‘¼å«ä»–çš„ç‰©ä»¶ ( `obj` )ã€‚

**å»ºæ§‹å¼ä¸­èª¿ç”¨**<br />
`const john = new Person()`ï¼Œå»ºæ§‹å¼ ( `Person` ) çš„ `this` æŒ‡å‘è¢«å»ºæ§‹çš„ç‰©ä»¶ ( `john` )ã€‚

**éš±å¼èª¿ç”¨**<br />
`fn.call()` `fn.apply()` `fn.bind()`ï¼Œä½¿ç”¨ callã€applyã€bind æ–¹å¼å°‡ç¬¬ä¸€å€‹åƒæ•¸æŒ‡å®š this æŒ‡å‘ä»»ä½•ç‰©ä»¶ã€‚

### 3. ä»¥ä¸‹é€™å€‹ this ä»£è¡¨ä»€éº¼å‘¢ ?

```jsx {2} showLineNumbers
function a() {
  console.log(this)
}
```

<details>
  <summary>Answer</summary>
  ä¸çŸ¥é“ï¼Œ<code>this</code> çš„å€¼èˆ‡ä½œç”¨åŸŸå’Œç¨‹å¼ç¢¼ä½ç½®å®Œå…¨ç„¡é—œï¼Œåªè·Ÿ<strong>
    ã€Œä½ å¦‚ä½•å‘¼å«ã€
  </strong>æœ‰é—œã€‚
</details>

<br />

## Reference

---

- [æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚](https://blog.huli.tw/2019/02/23/javascript-what-is-this/)
- [[é¢è©¦] å‰ç«¯å·¥ç¨‹å¸«ä¸€å®šè¦æœƒçš„ JS è§€å¿µé¡Œ-ä¸­è‹±å°ç…§ä¹‹ä¸Šç¯‡](https://medium.com/starbugs/%E9%9D%A2%E8%A9%A6-%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%B8%AB%E4%B8%80%E5%AE%9A%E8%A6%81%E6%9C%83%E7%9A%84-js-%E8%A7%80%E5%BF%B5%E9%A1%8C-%E4%B8%AD%E8%8B%B1%E5%B0%8D%E7%85%A7%E4%B9%8B%E4%B8%8A%E7%AF%87-3b0a3feda14f#ff68)

<br />
