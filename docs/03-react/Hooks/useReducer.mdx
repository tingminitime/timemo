---
id: react-reducer
title: React - useReducer
sidebar_label: useReducer
sidebar_position: 4
tags: [JavaScript, React, hooks, useReducer]
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import CodeBlock from '@theme/CodeBlock'

# useReducer

æ¯”èµ· `useState` åªèƒ½ç”¨ä¸€å€‹æ–¹æ³•ä¾†ç®¡ç†ç‹€æ…‹ï¼ŒReducer å¯ä»¥è®“æˆ‘å€‘æ›´éˆæ´»çš„ç®¡ç†è¤‡é›œçš„è³‡æ–™ç‹€æ…‹ã€‚

#### èˆ‰ä¾‹ä¾†èªªï¼Œåœ¨ä¸€å€‹æœ‰ CRUD çš„ Todo-list å¯èƒ½æœƒé•·é€™æ¨£ :

```jsx showLineNumbers title="TodoList.js"
function TodoList() {
  const [todos, setTodos] = useState([])
  const inputRef = useRef()

  // æ–°å¢ Todo
  function addTodoHandler() {
    setTodos([
      ...todos,
      {
        id: Date.now(),
        content: inputRef.current.value,
        completed: false,
      },
    ])
    inputRef.current.value = ''
  }

  // å®Œæˆ/å–æ¶ˆå®Œæˆ Todo
  function toggleTodoHandler(e, id) {
    setTodos(
      todos.map(todo => {
        return {
          ...todo,
          completed: todo.id === id ? e.target.checked : todo.completed,
        }
      })
    )
  }

  // ç·¨è¼¯ Todo
  function editTodoHandler(originalContent, id) {
    const editContent = prompt('è«‹è¼¸å…¥ä¿®æ”¹å…§å®¹', originalContent)
    if (!editContent) return
    setTodos(
      todos.map(todo => {
        return {
          ...todo,
          content: todo.id === id ? editContent : todo.content,
        }
      })
    )
  }

  // åˆªé™¤ Todo
  function deleteTodoHandler(id) {
    setTodos(todos.filter(todo => todo.id !== id))
  }

  return (
    <>
      <div>
        <input
          type="text"
          ref={inputRef}
        />
        <button
          type="button"
          onClick={addTodoHandler}
        >
          Add
        </button>
      </div>
      <ul>
        {todos.map(todo => (
          <li key={todo.id}>
            <div>
              <input
                type="checkbox"
                onChange={e => toggleTodoHandler(e, todo.id)}
              />
              <span>{todo.content}</span>
              <button
                type="button"
                onClick={() => editTodoHandler(todo.content, todo.id)}
              >
                Edit
              </button>
              <button
                type="button"
                onClick={() => deleteTodoHandler(todo.id)}
              >
                Delete
              </button>
            </div>
          </li>
        ))}
      </ul>
    </>
  )
}
```

å¯ä»¥æ³¨æ„ä¸€ä¸‹ï¼Œæ¯ä¸€å€‹ CRUD çš„æ–¹æ³•ä¸­éƒ½æœƒä½¿ç”¨åˆ° `setTodos` å»æ›´æ–°ç‹€æ…‹ï¼Œç•¶æœªä¾†é€™å€‹å…ƒä»¶çš„åŠŸèƒ½æ„ˆä¾†æ„ˆå¤šï¼Œä¸ç®¡æ˜¯åœ¨åŸæœ¬ CRUD æ–¹æ³•ä¸­éœ€è¦é¡å¤–æ·»åŠ é‚è¼¯ï¼Œæˆ–æ˜¯å…ƒä»¶æœ‰å…¶ä»–æ–°å¢çš„åŠŸèƒ½å°è‡´ function æ„ˆå¯«æ„ˆå¤šï¼Œéƒ½æœƒå½±éŸ¿åˆ°ç¨‹å¼çš„è¤‡é›œåº¦å’Œå¯è®€æ€§ã€‚

å› æ­¤ï¼Œç‚ºäº†é™ä½å…ƒä»¶çš„è¤‡é›œåº¦ï¼Œå°‡æŸå€‹è³‡æ–™ç‹€æ…‹çš„è™•ç†é‚è¼¯æ‹†åˆ†æ¸…æ¥šä¸¦é›†ä¸­ç®¡ç†ï¼ŒReducer å°±æ˜¯å…¶ä¸­ä¸€å€‹è§£è—¥ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘ä»‹ç´¹ä¸€ä¸‹ `useReducer` é€™å€‹ hook å§ !

:::info
Reducer çš„å–åä¾†è‡ªæ–¼ JavaScript é™£åˆ—æ“ä½œçš„ `reduce()` æ–¹æ³•ä¸­ç´¯ç©è³‡æ–™ç‹€æ…‹çš„ç‰¹æ€§ï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ [Why are reducers called this way ?](https://beta.reactjs.org/learn/extracting-state-logic-into-a-reducer#why-are-reducers-called-this-way)
:::

<br />

## `useReducer`

åŒå‰è¿°èªªæ˜ï¼Œæ˜¯ä¸€ç¨®ç®¡ç†è³‡æ–™ç‹€æ…‹çš„ hookï¼Œ`useState` çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ¥è¿‘ Redux å¯«æ³• ( é¡ä¼¼ Vuexã€Pinia )ã€‚

### åŸºæœ¬èªæ³•

```jsx
const [state, dispatch] = useReducer(reducer, initialArg, init?)
```

---

### ğŸ‘‰ åƒæ•¸ 1 : `reducer`

è² è²¬æ”¹è®Š `state` çš„ **pure function**ï¼Œreducer æœ‰å…©å€‹åƒæ•¸åˆ†åˆ¥æ˜¯ `state`ã€`action`ã€‚

```jsx showLineNumbers
function reducer(state, action) {
  // ...
}
```

- `state` : åŸæœ¬çš„è³‡æ–™ç‹€æ…‹
- `action` : ä¹Ÿå°±æ˜¯ `dispatch` å‚³å…¥çš„åƒæ•¸ï¼Œå¯ä»¥æ˜¯ä»»ä½•å‹åˆ¥ï¼Œä½†ä»¥å¸¸è¦é–‹ç™¼ä¾†èªªï¼Œé€šå¸¸æœƒæ˜¯ä¸€å€‹ç‰©ä»¶ ( object )ï¼Œä¸”åŒ…å«ä¸€å€‹ `type` ä¾†æŠ½è±¡æè¿°è¦å° `state` åšäº›ä»€éº¼äº‹æƒ…ã€‚

```jsx showLineNumbers
const reducer = (state, action) => {
  // é€šå¸¸æœƒä½¿ç”¨ switch ä¾æ“š action.type çš„æè¿°é€²è¡Œå‹•ä½œ
  switch (action.type) {
    case 'INCREMENT':
    // do something...
    case 'DECREMENT':
    // do something...
    default:
      return state
  }
}
```

Reducer æœ€é‡è¦çš„æ˜¯ä»–å¿…é ˆè¦æ˜¯ä¸€å€‹ **pure function**ï¼Œä¹Ÿå°±æ˜¯ã€ŒOne input, One outputã€ï¼Œè¼¸å…¥åŒä¸€å€‹å€¼ï¼Œå›å‚³çš„å€¼å¿…é ˆç›¸åŒï¼Œä¸èƒ½å° `state` æœ‰ä»»ä½• mutate çš„è¡Œç‚ºã€‚

```jsx showLineNumbers
const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT':
      // error-next-line
      state.count += 1 // éŒ¯èª¤å¯«æ³•
      return state
    default:
      return state
  }
}
```

é€™æ¨£ç›´æ¥æ”¹è®ŠåŸæœ¬è³‡æ–™çš„è¡Œç‚ºé›–ç„¶ä¸æœƒå ±éŒ¯ï¼Œä½†ä¸å»ºè­°é€™éº¼åšã€‚

---

### ğŸ‘‰ åƒæ•¸ 2 : `initialArg`

åˆå§‹çš„è³‡æ–™ç‹€æ…‹ï¼Œå¯ä»¥æ˜¯ä»»ä½•å‹åˆ¥ï¼Œä½†æœƒä½¿ç”¨ useReducer é€šå¸¸æ˜¯å› ç‚ºæœ‰è¼ƒè¤‡é›œçš„è³‡æ–™ç‹€æ…‹éœ€è¦ç®¡ç†ï¼Œæ‰€ä»¥ä¸€èˆ¬æœƒçµ¦å®šä¸€å€‹ç‰©ä»¶ä¸¦ä¸”åŒ…å«æ‰€éœ€çš„åˆå§‹è³‡æ–™ã€‚

```jsx
const initialCount = { count: 0 }
```

---

### ğŸ‘‰ åƒæ•¸ 3 : `init(option)`

é€™å€‹åƒæ•¸æ˜¯å¯é¸çš„ï¼Œä¸€èˆ¬æƒ…æ³è »å°‘æœƒç”¨åˆ°ï¼Œ`init` æœƒæ˜¯ä¸€å€‹ function ä¸”éœ€è¦ return ä¸€å€‹å€¼ï¼Œä¸¦ä¸”æœƒå‚³å…¥ `initialArg` ( ä¹Ÿå°±æ˜¯åˆå§‹è³‡æ–™ç‹€æ…‹ ) ç•¶ä½œåƒæ•¸ã€‚

```jsx showLineNumbers
function init(initialCount) {
  // You can do something...
  return initialCount
}
```

æœƒä½¿ç”¨åˆ° `init` é€šå¸¸æ˜¯ç‚ºäº†å¯¦ç¾ lazy initializationï¼Œé€™èˆ‡ `useState` çš„ [initializer function](https://beta.reactjs.org/reference/react/useState#parameters) æ¦‚å¿µå·®ä¸å¤šï¼Œå¯ä»¥é¿å…é‡è¤‡åŸ·è¡Œæˆæœ¬è¼ƒé«˜çš„è³‡æ–™ç‹€æ…‹åˆå§‹åŒ–æ–¹æ³•ã€‚

<br />

```jsx showLineNumbers
function CustomerList() {
  const initialCustomerData = loadCustomerData()
  const [customerData, dispatch] = useReducer(reducer, initialCustomerData)
  // ...
}
```

ä¸Šé¢çš„ç¨‹å¼ç¢¼ä¸­ï¼Œ`loadCustomerData()` å‡è¨­æ˜¯åŸ·è¡Œæˆæœ¬æ¯”è¼ƒé«˜çš„æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡ `CustomerList` é€™å€‹å…ƒä»¶ re-render æ™‚éƒ½æœƒè¢«é‡æ–°åŸ·è¡Œï¼Œè¦é¿å…é‡æ–°åŸ·è¡Œå°±å¯ä»¥ä½¿ç”¨ `init` :

```jsx showLineNumbers
function CustomerList() {
  const init = () => loadCustomerData()
  const [customerData, dispatch] = useReducer(reducer, {}, init)
  // ...
}
```

é€™å€‹ `init` å°±åªæœƒåœ¨ `useReducer` ç¬¬ä¸€æ¬¡åŸ·è¡Œæ™‚å‘¼å«ï¼Œæ¸›å°‘äº†ä¸€ç›´é‡æ–°åŸ·è¡Œå¸¶ä¾†çš„æ•ˆèƒ½å•é¡Œã€‚

---

### ğŸ‘‰ å›å‚³å€¼ : `state`

åœ¨å…ƒä»¶åˆæ¬¡æ¸²æŸ“æ™‚ï¼Œæœƒå›å‚³ `initialArg` æˆ–æ˜¯ `init(initialArg)` çš„å›å‚³å€¼ï¼Œè‹¥ä½¿ç”¨ `dispatch` æ›´æ–° `state`ï¼Œå‰‡æœƒè§¸ç™¼ re-renderï¼Œä¸¦ä¸”å›å‚³æ–°çš„ `state`ã€‚

---

### ğŸ‘‰ å›å‚³å€¼ : `dispatch`

`dispatch` æ˜¯ä¸€å€‹ functionï¼ŒåŸ·è¡Œæ™‚æœƒèª¿ç”¨ `reducer`ï¼Œä¸¦ä¸”å¯ä»¥å‚³å…¥ä¸€å€‹åƒæ•¸ï¼Œé€™å€‹åƒæ•¸æœƒå‚³éçµ¦ reducer function çš„ `action` åƒæ•¸åšä½¿ç”¨ã€‚

```jsx showLineNumbers
const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT':
    // do something..
    case 'DECREMENT':
    // do something...
    default:
      return state
  }
}

// highlight-next-line
dispatch({ type: 'INCREMENT' })
```

å‰é¢æœ‰æåˆ°ï¼Œ`action` é€šå¸¸æœƒæ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œä¸¦ä¸”è£¡é¢æœ‰ `type` ä¾†æè¿°**æŠ½è±¡è¡Œç‚º**ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ `dispatch({ type: 'INCREMENT' })` è®“ `reducer` è£¡é¢åŸ·è¡Œ `switch` åˆ¤æ–·è¦åšä»€éº¼äº‹æƒ…ã€‚

ä¸é `dispatch` æœ‰å€‹éœ€è¦æ³¨æ„çš„é»ï¼Œèˆ‡ `useState` ä¸€æ¨£ï¼Œç•¶æ¬¡å…ƒä»¶ render æ‰€ç²å–çš„ `state` è³‡æ–™ç‹€æ…‹éƒ½æ˜¯ä¸è®Šçš„ï¼Œä¾‹å¦‚ :

```jsx showLineNumbers
const initialCount = { count: 0 }

const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT': // æŠ½è±¡æè¿° : æˆ‘è¦å¢åŠ  count
      return { count: state.count + 1 }
    case 'DECREMENT': // æŠ½è±¡æè¿° : æˆ‘è¦æ¸›å°‘ count
      return { count: state.count - 1 }
    default:
      return state
  }
}

function App() {
  const [state, dispatch] = useReducer(reducer, initialCount)

  function clickHandler() {
    dispatch({ type: 'INCREMENT' })
    // highlight-next-line
    console.log(state.count) // æ­¤æ™‚ log å‡ºä¾†ä¾ç„¶æ˜¯ dispatch ä¹‹å‰çš„ç‹€æ…‹ 0
  }
  // ...
}
```

å¯ä»¥æƒ³åƒæ¯ä¸€æ¬¡å…ƒä»¶çš„ render éƒ½æ˜¯ä¸€å€‹å¿«ç…§ ( snapshot )ï¼Œåœ¨é€™å€‹å¿«ç…§çš„ state æ˜¯ä¸æœƒæ”¹è®Šçš„ï¼Œè€Œ `dispatch` **æ”¹è®Šå¾Œ**çš„ state æ˜¯åœ¨**ä¸‹ä¸€æ¬¡**çš„å¿«ç…§ä¸­ ( next snapshot ) çš„ç‹€æ…‹ï¼Œå› æ­¤è‹¥æ˜¯æƒ³åœ¨ `dispatch` å¾Œèƒ½ç«‹å³æ‹¿åˆ°ä¸‹ä¸€æ¬¡å¿«ç…§çš„ç‹€æ…‹ï¼Œå¯ä»¥é€™éº¼åš :

```jsx showLineNumbers
const initialCount = { count: 0 }

const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT':
      return { count: state.count + 1 }
    case 'DECREMENT':
      return { count: state.count - 1 }
    default:
      return state
  }
}

function App() {
  const [state, dispatch] = useReducer(reducer, initialCount)

  function clickHandler() {
    const action = { type: 'INCREMENT' }
    dispatch(action)
    const nextState = reducer(state, action)
    // highlight-next-line
    console.log(state.count) // æ­¤æ™‚ log å‡ºä¾†çš„å°±æ˜¯ dispatch å¾Œçš„ç‹€æ…‹ 1
  }
  // ...
}
```

:::tip
ğŸ’¡ å…¶å¯¦å¿«ç…§ ( snapshot ) å°±æ˜¯ JavaScript çš„ [é–‰åŒ… ( closure )](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures) åŸç†ã€‚
:::

---

## ç”¨ `useReducer` å¯¦ä½œä¸€å€‹ TodoList

è®“æˆ‘å€‘ç”¨ `useReducer` ä¾†æ”¹å¯«ä¸€é–‹å§‹çš„ [Todo-list](#èˆ‰ä¾‹ä¾†èªªåœ¨ä¸€å€‹æœ‰-crud-çš„-todo-list-å¯èƒ½æœƒé•·é€™æ¨£-) å§ï¼Œé è¨ˆä½¿ç”¨åˆ°çš„æª”æ¡ˆæœƒæ˜¯é€™æ¨£ :

- `./App.js`
- `./components/TodoList.js`
- `./components/TodoItem.js`
- `./reducers/TodoReducer.js`

### Step 1 : å»ºç«‹ä¸€å€‹ TodoReducer.js

é€™å€‹ `TodoReducer.js` å°±æ˜¯å°ˆé–€è™•ç†å° Todo-list æ‰€æœ‰æ“ä½œé‚è¼¯çš„ç¨‹å¼ã€‚

åœ¨æ’°å¯«é‚è¼¯å‰ï¼Œå…ˆä¾†åˆ¶å®šé€™å€‹ reducer çš„åˆå§‹ç‹€æ…‹ `initialArg`ã€‚

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
export const initState = {
  todoList: [],
}
```

é€™é‚Šæœ€å¤–å±¤ä½¿ç”¨ç‰©ä»¶åŒ…è£ï¼Œè£¡é¢åŒ…å« Todo-list çš„é™£åˆ—è³‡æ–™ï¼Œä¹Ÿè¨±åœ¨é€™å€‹ç¯„ä¾‹ä¸éœ€è¦é€™éº¼åšï¼Œä½†é€™éº¼åšçš„åŸå› æ˜¯æƒ³å’Œå¤§å®¶èªªæ˜ï¼Œè‹¥é€™å€‹ state æœ‰æ“´å……è³‡æ–™çš„éœ€æ±‚ï¼Œç‰©ä»¶æœƒæ¯”é™£åˆ—æ–¹ä¾¿è¨±å¤šã€‚

æ¥ä¸‹ä¾†å°±æ˜¯æˆ‘å€‘ reducer çš„ä¸»ç¨‹å¼ :

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
export const initState = {
  todoList: [],
}

function TodoReducer(state, action) {
  switch (action.type) {
    case 'ADD_TODO':
    // do something...
    case 'TOGGLE_TODO':
    // do something...
    case 'EDIT_TODO':
    // do something...
    case 'DELETE_TODO':
    // do something...
    default:
      return state
  }
}

export default TodoReducer
```

çœ‹åˆ° `case` å°æ‡‰çš„æŠ½è±¡æè¿°å­—ä¸²ï¼Œæ­¤æ™‚å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œè¬ä¸€ä¹‹å¾Œæˆ‘å€‘å°é€™å€‹æŠ½è±¡æè¿°å­—ä¸²ä¸æ»¿æ„è¦æ›´æ”¹ï¼Œæœƒéœ€è¦ä¸€åŒæ›´æ”¹æ‰€æœ‰ä½¿ç”¨åˆ°å°æ‡‰çš„ `dispatch`ï¼Œéå¸¸éº»ç…©ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€™éº¼åš :

```jsx {1-6} showLineNumbers title="./src/reducers/TodoReducer.js"
export const ACTIONS = {
  ADD_TODO: 'ADD_TODO',
  TOGGLE_TODO: 'TOGGLE_TODO',
  EDIT_TODO: 'EDIT_TODO',
  DELETE_TODO: 'DELETE_TODO',
}

export const initState = {
  todoList: [],
}

function TodoReducer(state, action) {
  switch (action.type) {
    case ACTIONS.ADD_TODO:
    // do something...
    case ACTIONS.TOGGLE_TODO:
    // do something...
    case ACTIONS.EDIT_TODO:
    // do something...
    case ACTIONS.DELETE_TODO:
    // do something...
    default:
      return state
  }
}

export default TodoReducer
```

å°‡æ‰€æœ‰æŠ½è±¡æè¿°å­—ä¸²ä½¿ç”¨ç‰©ä»¶å°è£è®Šæ•¸ `ACTIONS`ï¼Œä¸¦ä¸”å°‡å®ƒ `export` æ–¹ä¾¿æˆ‘å€‘åœ¨å…¶ä»–æª”æ¡ˆå¼•å…¥çµ¦ `dispatch` ä½¿ç”¨ï¼Œè€Œ `case` æ‰€éœ€è¦å°æ‡‰çš„å­—ä¸²ç›´æ¥å‘¼å«è©²ç‰©ä»¶çš„ `key`ï¼Œåœ¨æ’°å¯«çš„æ™‚å€™ä½ æœƒç™¼ç¾é…åˆä½ çš„ç·¨è¼¯å™¨æç¤ºåŠŸèƒ½ï¼Œæ›´ä¸å®¹æ˜“æ‰“éŒ¯å­—äº† !

<br />

### Step 2 : æ’°å¯« reducer è£¡é¢æŠ½è±¡æè¿°çš„é‚è¼¯

æ¥ä¸‹ä¾†å°±é–‹å§‹ç‚ºæ¯å€‹ `action.type` æ’°å¯«å°æ‡‰çš„é‚è¼¯ï¼Œ**é€™å€‹æ­¥é©Ÿå‹™å¿…æ³¨æ„ä¸èƒ½å° `state` æœ‰ä»»ä½• mutate çš„è¡Œç‚º**ï¼Œå¦å¤–ä¹Ÿå»ºè­°æ¯å€‹ `case` ä½¿ç”¨ block scope `{ }` åŒ…ä½ï¼Œé¿å… `case` è£¡é¢çš„è®Šæ•¸èˆ‡å…¶ä»– `case` çš„è®Šæ•¸äº’ç›¸è¡çªã€‚

**æ–°å¢ Todo :**

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
// ...
function addTodo(todoContent = '') {
  return {
    id: crypto.randomUUID(),
    content: todoContent,
    completed: false,
  }
}

function TodoReducer(state, action) {
  const { payload } = action

  switch (action.type) {
    case ACTIONS.ADD_TODO: {
      return {
        ...state,
        todoList: [...state.todoList, addTodo(payload.content)],
      }
    }
    // ...
  }
}

export default TodoReducer
```

æ–°å¢ä¸€å€‹ `addTodo` å‡½å¼ `return` æ–°çš„ Todo ç‰©ä»¶ï¼Œä¸¦ä¸”å°‡æ¥ä¸‹ä¾†æ“ä½œæœ‰ç”¨çš„è³‡æ–™æ”¾åœ¨ `payload` ç‰©ä»¶è£¡é¢ã€‚

**å®Œæˆ / å–æ¶ˆå®Œæˆ Todo :**

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
// ...
function TodoReducer(state, action) {
  const { payload } = action

  switch (action.type) {
    // ...
    case ACTIONS.TOGGLE_TODO: {
      const newTodo = state.todoList.map(todo => {
        return {
          ...todo,
          completed: todo.id === payload.id ? payload.checked : todo.completed,
        }
      })

      return {
        ...state,
        todoList: newTodo,
      }
    }
    // ...
  }
}

export default TodoReducer
```

**ç·¨è¼¯ Todo :**

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
// ...
function TodoReducer(state, action) {
  const { payload } = action

  switch (action.type) {
    // ...
    case ACTIONS.EDIT_TODO: {
      const newTodo = state.todoList.map(todo => {
        return {
          ...todo,
          content: todo.id === payload.id ? payload.content : todo.content,
        }
      })

      return {
        ...state,
        todoList: newTodo,
      }
    }
    // ...
  }
}

export default TodoReducer
```

**åˆªé™¤ Todo :**

```jsx showLineNumbers title="./src/reducers/TodoReducer.js"
// ...
function TodoReducer(state, action) {
  const { payload } = action

  switch (action.type) {
    // ...
    case ACTIONS.DELETE_TODO: {
      const newTodo = state.todoList.filter(todo => todo.id !== payload.id)

      return {
        ...state,
        todoList: newTodo,
      }
    }
    // ...
  }
}

export default TodoReducer
```

<details>
  <summary>
    <code>TodoReducer.js</code> <strong>å®Œæ•´ç¨‹å¼ç¢¼</strong>
  </summary>
  <CodeBlock
    language="jsx"
    title="./src/reducers/TodoReducer.js"
    showLineNumbers
  >
    {`export const ACTIONS = {
  ADD_TODO: 'ADD_TODO',
  TOGGLE_TODO: 'TOGGLE_TODO',
  EDIT_TODO: 'EDIT_TODO',
  DELETE_TODO: 'DELETE_TODO',
}\n\nexport const initState = {
  todoList: [],
}\n\nfunction addTodo(todoContent = '') {
  return {
    id: crypto.randomUUID(),
    content: todoContent,
    completed: false,
  }
}\n\nfunction TodoReducer(state, action) {
  const { payload } = action\n
  switch (action.type) {
    case ACTIONS.ADD_TODO: {
      return {
        ...state,
        todoList: [...state.todoList, addTodo(payload.content)],
      }
    }\n
    case ACTIONS.TOGGLE_TODO: {
      const newTodo = state.todoList.map(todo => {
        return {
          ...todo,
          completed: todo.id === payload.id ? payload.checked : todo.completed,
        }
      })\n
      return {
        ...state,
        todoList: newTodo,
      }
    }\n
    case ACTIONS.EDIT_TODO: {
      const newTodo = state.todoList.map(todo => {
        return {
          ...todo,
          content: todo.id === payload.id ? payload.content : todo.content,
        }
      })\n
      return {
        ...state,
        todoList: newTodo,
      }
    }\n
    case ACTIONS.DELETE_TODO: {
      const newTodo = state.todoList.filter(todo => {
        return todo.id !== payload.id
      })\n
      return {
        ...state,
        todoList: newTodo,
      }
    }\n
    default: {
      return state
    }\n}
\nexport default TodoReducer
`}

  </CodeBlock>
</details>

<br />

### Step 3 : åœ¨ `TodoList` å…ƒä»¶å¼•å…¥ `TodoReducer` ä½¿ç”¨

```jsx {2,5,42} showLineNumbers title="./src/components/TodoList.js"
import TodoItem from './TodoItem'
import TodoReducer, { ACTIONS, initState } from './contexts/TodoReducer'

function TodoList() {
  const [state, dispatch] = useReducer(TodoReducer, initState)
  const todoInputRef = useRef(null)

  // æ–°å¢ Todo
  function addTodo() {
    if (!todoInputRef.current.value.trim()) {
      alert('è«‹è¼¸å…¥å…§å®¹')
      return
    }

    dispatch({
      type: ACTIONS.ADD_TODO,
      payload: { content: todoInputRef.current.value },
    })
    todoInputRef.current.value = ''
    todoInputRef.current.focus()
  }

  return (
    <>
      <div>
        <input
          type="text"
          ref={todoInputRef}
          onKeyDown={e => (e.code === 'Enter' ? addTodo() : null)}
        />
        <button
          type="button"
          onClick={addTodo}
        >
          Add
        </button>
      </div>
      <ul>
        {state.todoList.map(todo => (
          <TodoItem
            key={todo.id}
            todo={todo}
            dispatch={dispatch}
          ></TodoItem>
        ))}
      </ul>
    </>
  )
}

export default TodoList
```

é€™é‚Šå°‡ `dispatch` æ–¹æ³•ä½¿ç”¨ props çš„æ–¹å¼å‚³éçµ¦ `TodoItem` å…ƒä»¶ä½¿ç”¨ :

```jsx showLineNumbers title="./src/components/TodoItem.js"
import { ACTIONS } from './contexts/TodoReducer'

// highlight-next-line
function TodoItem({ todo, dispatch }) {
  // å®Œæˆ/å–æ¶ˆå®Œæˆ Todo
  function toggleTodo(e, id) {
    dispatch({
      type: ACTIONS.TOGGLE_TODO,
      payload: {
        id,
        checked: e.target.checked,
      },
    })
  }

  // ç·¨è¼¯ Todo
  function editTodo(id, content) {
    const editContent = prompt('è«‹è¼¸å…¥ä¿®æ”¹å…§å®¹', content) || content

    dispatch({
      type: ACTIONS.EDIT_TODO,
      payload: {
        id,
        content: editContent,
      },
    })
  }

  // åˆªé™¤ Todo
  function deleteTodo(id) {
    dispatch({
      type: ACTIONS.DELETE_TODO,
      payload: {
        id,
      },
    })
  }

  return (
    <li key={todo.id}>
      <div>
        <input
          type="checkbox"
          onChange={e => toggleTodo(e, todo.id)}
        />
        <span>{todo.content}</span>
        <button
          type="button"
          onClick={() => editTodo(todo.id, todo.content)}
        >
          Edit
        </button>
        <button
          type="button"
          onClick={() => deleteTodo(todo.id)}
        >
          Delete
        </button>
      </div>
    </li>
  )
}

export default TodoItem
```

**ğŸ‰ å¤§åŠŸå‘Šæˆ !!**

<iframe
  src="https://codesandbox.io/embed/react-usereducer-sample1-qnd3ud?fontsize=14&hidenavigation=1&theme=dark"
  style={{
    width: '100%',
    height: '500px',
    border: 0,
    borderRadius: '4px',
    overflow: 'hidden',
  }}
  title="react-useReducer-sample1"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>

[CodeSandbox å®Œæ•´ç¨‹å¼ç¢¼](https://codesandbox.io/s/react-usereducer-sample1-qnd3ud)

<br />

## å¯«ä¸€å€‹ä½¿ç”¨ `useState` æ¨¡æ“¬ `useReducer` çš„ Custom Hook !

é€™ä¹Ÿæ˜¯å®˜æ–¹æ–‡ä»¶ [Extracting State Logic into a Reducer](https://beta.reactjs.org/learn/extracting-state-logic-into-a-reducer) çš„ [Challenges](https://beta.reactjs.org/learn/extracting-state-logic-into-a-reducer#challenges) ç¬¬ 4 é¡Œã€‚

å…ˆæº–å‚™ä¸€å€‹ç°¡å–®å¢æ¸› `count` çš„ reducer :

```jsx showLineNumbers title="./src/reducers/CountReducer.js"
const ACTIONS = {
  INCREMENT: 'INCREMENT',
  DECREMENT: 'DECREMENT',
}

const CountReducer = (state, action) => {
  switch (action.type) {
    case ACTIONS.INCREMENT: {
      return { count: state.count + 1 }
    }
    case ACTIONS.DECREMENT: {
      return { count: state.count - 1 }
    }
    default: {
      return state
    }
  }
}
```

å†ä¾†æ˜¯ Custom Hook : `useMyReducer`

```jsx showLineNumbers title="./src/hooks/useMyReducer.js"
import { useState } from 'react'

function useMyReducer(reducer, initialState) {
  const [state, setState] = useState(initialState)

  function dispatch(action) {
    const nextState = reducer(state, action)
    setState(nextState)
  }

  return [state, dispatch]
}

export default useMyReducer
```

`useMyReducer` æœƒèˆ‡ React åŸç”Ÿçš„ `useReducer` ä¸€æ¨£æœƒæœ‰å…©å€‹ä¸»è¦åƒæ•¸ï¼Œç¬¬ä¸€å€‹åƒæ•¸æ˜¯ `reducer`ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å‰›å‰›æº–å‚™çš„ `CountReducer`ï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯ `initialState`ï¼Œæœƒå°‡å®ƒç•¶ä½œ `useState` çš„åˆå§‹å€¼ã€‚

é‚„è¨˜å¾—æˆ‘å€‘åœ¨å‰é¢æåˆ°çš„å¿«ç…§ ( snapshot ) å— ? è£¡é¢çš„ `dispatch` æ–¹æ³•å°±æ˜¯åˆ©ç”¨åŸ·è¡Œ `reducer(state, action)` ä¾†ç²å–ä¸‹ä¸€æ¬¡çš„ `state` å¿«ç…§ï¼Œç„¶å¾Œå†ä½¿ç”¨ `setState` æ”¹è®Š `state` ä¸¦å›å‚³ã€‚

å¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¯ä»¥æ‡‰ç”¨åœ¨æˆ‘å€‘çš„å…ƒä»¶ä¸Šå›‰ !

```jsx
import CountReducer from './reducers/CountReducer'
import useMyReducer from './hooks/useMyReducer'

const initialCount = { count: 0 }

function App() {
  const [state, dispatch] = useMyReducer(CountReducer, initialCount)

  return (
    <div>
      <button
        type="button"
        onClick={() => dispatch({ type: 'DECREMENT' })}
      >
        -
      </button>
      <span>{state.count}</span>
      <button
        type="button"
        onClick={() => dispatch({ type: 'INCREMENT' })}
      >
        +
      </button>
    </div>
  )
}
```

<iframe
  src="https://codesandbox.io/embed/custom-hook-usereducer-0gex8i?fontsize=14&hidenavigation=1&theme=dark"
  style={{
    width: '100%',
    height: '500px',
    border: 0,
    borderRadius: '4px',
    overflow: 'hidden',
  }}
  title="custom-hook-useReducer"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>

[CodeSandbox å®Œæ•´ç¨‹å¼ç¢¼](https://codesandbox.io/s/custom-hook-usereducer-0gex8i)

<br />

## ç¸½çµ

ä»¥ä¸‹æƒ…æ³å¯ä»¥è€ƒæ…®ä½¿ç”¨ `useReducer` :

- å…ƒä»¶å…§ä½¿ç”¨åˆ°å¾ˆå¤š `useState` ä¾†è™•ç†ç›¸ä¼¼çš„é‚è¼¯æ“ä½œã€‚
- æƒ³è¦æ›´æœ‰æ¢ç†çš„ç®¡ç†è³‡æ–™ç‹€æ…‹ã€‚
- ä¸åŒå±¤ç´šçš„å…ƒä»¶ä½¿ç”¨åˆ° Contextï¼Œè€Œ Context çš„è³‡æ–™ç‹€æ…‹éœ€è¦è¢«æ“ä½œæ™‚ã€‚

å¸Œæœ›é€™å€‹ç­†è¨˜å°å¤§å®¶æœ‰å¹«åŠ©ï¼Œå¦‚æœæœ‰éŒ¯èª¤æˆ–ä¸å¤ æ¸…æ¥šçš„åœ°æ–¹ä¹Ÿæ­¡è¿åœ¨åº•ä¸‹ç•™è¨€è®“æˆ‘æ”¹é€² (-Ï‰-ã‚

<br />

## Reference

---

- [useReducer](https://beta.reactjs.org/reference/react/useReducer)
- [Extracting State Logic into a Reducer](https://beta.reactjs.org/learn/extracting-state-logic-into-a-reducer#comparing-usestate-and-usereducer)
- [çµ‚ç©¶éƒ½è¦å­¸ React ä½•ä¸ç¾åœ¨å­¸å‘¢ï¼Ÿ - React é€²éš - useReducer - (15) - iT é‚¦å¹«å¿™::ä¸€èµ·å¹«å¿™è§£æ±ºé›£é¡Œï¼Œæ‹¯æ•‘ IT äººçš„ä¸€å¤©](https://ithelp.ithome.com.tw/articles/10299714)
- [What's the purpose of the 3rd argument in useReducer?](https://stackoverflow.com/questions/59041341/whats-the-purpose-of-the-3rd-argument-in-usereducer#comment104325264_59041341)
